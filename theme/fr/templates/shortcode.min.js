/**
 * jQuery Shortcode parser
 * 
 * @author Michael Hurni <michael.hurni@troll-idees.com>
 * @copyright Copyright (c) Troll d'idées 2013. Tous droits réservés.
 * @licence Beerware
 *
 * @example
 *  $.shortcode.register('h1', function( attributes ){
 *  	return $('<h1>').text(attributes.title.toUpperCase());
 *  });
 *  
 *  $(document.body).shortcode();
 *
 * remplace le shortcode h1 par un <h1> contenant la valeur de l'attribut title
 * <p>lorem ipsum [h1 title="test"] amet</p>
 * devient
 * lorem ipsum <h1>TEST</h1> amet</p>
 */
(function(c){var a={};var b=new RegExp("^[a-z0-9_:.-]+$","i");c.shortcode=function(){return c.fn.shortcode.apply(c(document.body),arguments)};c.shortcode.register=function(e,d){b.test(e)||c.error("Invalid shortcode name");c.isFunction(d)||c.error("Invalid shortcode callback");a[e]=d};c.fn.shortcode=function(){var h=this;var e=[];if(!h.length){return h}c.each(a||{},function(i){if(typeof name=="string"&&i!=arguments[0]){return}if(c.isArray(arguments[0])&&!c.inArray(i,arguments[0])){return}e.push(i)});if(!e.length){return this}var s=h.toArray();var o=[];var p=new RegExp("\\[("+e.join("|")+")( [^\\]]+)?\\/?\\](?:(.*)\\[\\/\\1\\])?","i");var m=false;var j;while((j=s.shift())){if(c.inArray(j,o)>=0){continue}if(j.nodeType==1){for(var l=0,r=j.childNodes.length;l<r;l++){s.push(j.childNodes[l])}}if(j.nodeType!=3){o.push(j);continue}if(j.nodeName=="SCRIPT"||j.nodeName=="STYLE"){continue}m=p.exec(j.nodeValue.replace(/\xA0/," "));if(!m){continue}var k={};var f;if(m[2]){var d=c("<div "+m[2]+">")[0].attributes;for(var q=0,n=d.length;q<n;q++){k[d[q].name.toLowerCase()]=d[q].value}}if(m[0].length==j.nodeValue.length){f=j}else{f=j.splitText(m.index);var g=f.splitText(m[0].length);s.push(g)}c(f).replaceWith(a[m[1]].call(c(f),k,m[3]))}o=[];return this}})(jQuery);